# 3. 데이터링크 계층

> 데이터링크: 인접한 기기 사이에 만드는 논리적인 전송로
> 

## 📌 3.1 유선 LAN(IEEE802.3)

데이터링크 계층은 `어떤 단말에 대해 데이터링크를 만드는지`, 만들어진 데이터링크 안에 `비트가 누락되지는 않았는지`를 판단하기 위해 캡슐화 처리로 물리 계층의 신뢰성을 확보한다.

**IEEE802.3으로 표준화된 이더넷에서는 어떤 포맷으로 캡슐화하고 어떻게 에러를 검출하는지 정의하고 있다.**

### 3.1.1 이더넷의 프레임 포맷

이더넷 프레임: 이더넷에 의해 캡슐화된 패킷

이더넷 프레임 포맷 종류

- 이더넷 **Ⅱ 규약**
- IEEE802.3 규약

### **▶️ 이더넷 Ⅱ 규약**

> 웹, 메일, 파일 공유에서 인증에 이르기까지 TCP/IP로 교환하는 대부분의 패킷이 이더넷 **Ⅱ 규약을 사용하고 있다.**
> 

**이더넷 Ⅱ의 구성 요소**

- 이더넷 헤더(ethernet header)
    - 프리앰블(preamble)
    - 수신지/송신지 MAC 주소
    - 타입
- 이더넷 페이로드(ethernet payload)
- 이더넷 트레일러(ethernet trailer, `= FCS`)

![image](https://github.com/user-attachments/assets/1445674d-650c-4101-90d1-148da7017cd4)


### **프리앰블**

이더넷 프레임 포맷의 전단부.

수신 측 단말은 프리앰블을 통해 즉, 특별한 비트 패턴(`10101010` 7개 + `10101011` 1개)을 보고 이더넷 프레임의 전송을 확인한다.

### 수신지/송신지 MAC 주소

> MAC: 이더넷 네트워크에 접속하고 있는 단말을 식별하는 6바이트의 ID
> 

- 수신지 MAC 주소: 이더넷 프레임을 전달하고자 하는 단말의 MAC 주소
    - 수신 측 단말은 수신지 MAC 주소를 보고 자신의 MAC 주소라면 프레임을 받고 아니라면 파기
    - 또한 송신지 MAC 주소를 보고 어떤 단말에서 온 이더넷 프레임인지 판별
- 송신지 MAC 주소: 자신의 MAC(송신지) 주소

### 타입

> 네트워크 계층에서 어떤 프로토콜을 사용하는지 나타내는 2바이트의 ID
> 

대표적인 프로토콜 타입 코드

| 타입 코드 | 프로토콜 |
| --- | --- |
| 0x0000 -05D | IEEE802.3 Length Field |
| 0x0800 | IPv4(Internet Protocol version 4) |
| 0x0806 | ARP(Address Resolution Protocol) |
| 0x8035 | RARP(Reverse Address Resolution Protocol) |
| 0x86DD | IPv6(Internet Protocol version 6) |
| 0x8863 | PPPoE(Point-to-Point Protocol over Ethernet) Discovery Stage |
| 0x8864 | PPPoE(Point-to-Point Protocol over Ethernet) Session Stage |

### 이더넷 페이로드

> 네트워크 계층의 데이터 자체
> 

ex) 네트워크 계층에서 IP를 사용 시 ⇒ **이더넷 페이로드 == IP 패킷**

이더넷 페이로드의 경우, 46~1500바이트 범위 안에 들어가야만 함

46바이트 미만일 시 ⇒ 패딩으로 처리

1500바이트 초과일 시 ⇒ 트랜스포트 계층 또는 네트워크 계층에서 데이터 잘라냄

### FCS(Frame Check Sequence, 이더넷 트레일러)

> 이더넷 프레임이 손상되지 않았는지 확인하기 위한 4바이트 필드
> 

![image](https://github.com/user-attachments/assets/61b2522c-c770-4388-b99d-00103eb49bfe)


그림 3.1.4 그림으로 공부하는 TCP/IP 

이더넷 송신 시, 수신지/송신지 MAC 주소, 타입, 이더넷 페이로드에 대해 **일정한 계산(체크섬 계산, CRC)** 수행

수신 단말 또한 같은 계산해서 결과 값과 FCS 값 동일 여부에 따라 **이더넷 프레임 손상 여부** 확인

⇒ `FCS는 이더넷 에러 감지의 전부를 담당`

### 3.1.2 MAC 주소

### **▶️** MAC 주소

> 이더넷 네트워크에 접속되어 있는 단말의 식별 ID
> 

- 6바이트로 구성
- 1바이트씩 하이픈(-) 또는 콜론(:) 으로 구분해 12자리의 16진수로 표기
- 상위 3바이트
    - OUI: IEEE가 벤더별로 할당한 벤더 코드
- 하위 3바이트
    - UAA: 출하 시 벤더에서 할당하거나 무작위로 생성한 값

![image](https://github.com/user-attachments/assets/3ea13285-6f05-4d42-814e-0d80697c1157)


### **▶️** 통신 종류에 따른 MAC 주소의 차이

다음 3가지 통신은 수신지에 따라 구분해서 사용하며, 수신지 MAC 주소에 설정된 MAC 주소가 조금씩 다르다.

### 유니캐스트

`1:1 통신`

송수신하는 각 단말의 MAC 주소가 송신지 MAC 주소와 수신지 MAC 주소.

ex) 웹, 메일 등 인터넷 통신의 대부분

### 브로드캐스트

`1:n 통신`

여기서 n은 같은 **이더넷 네트워크에 접속되어 있는 자신 외의 모든 단말**

어떤 단말이 브로드캐스트를 송신하면 그 이더넷 네트워크에 있는 자신 이외의 모든 단말이 그 프레임을 수신.

브로드캐스트가 도달하는 범위 ⇒ **브로드캐스트 도메인**

ex) ARP와 같은 네트워크 상의 모든 단말에 알림 및 문의 시 사용

### 멀티캐스트

`1:n 통신`

여기서 n은 **특정 그룹(멀티캐스트 그룹)에 속하는 단말**

어떤 단말이 멀티캐스트를 송신하면 그 그룹에 있는 단말들만 그 패킷을 수신.

ex) 동영상 전송, 주식 거래 애플리케이션 등

브로드캐스트와의 차이점

- 해당 네트워크에 있는 모든 단말이 강제로 패킷을 수신 ⇒ 브로드캐스트
- 애플리케이션을 가동한 단말만 패킷을 수신할 수 있음. ⇒ 멀티캐스트
    - 트래픽 효율 ⬆️

### 멀티캐스트의 송신지/수신지 MAC 주소

송신지 MAC 주소

- 송신지 단말의 MAC 주소 그대로 입력

수신지 MAC 주소

- 네트워크 계층에서 사용하는 IP 버전에 따라 다름
- IPv4를 통한 수신지 MAC 주소
    - **상위 25비트 고정** ⇒ `0000 0001 0000 0000 0101 1110 0` , 01 00 5e
    - **하위 23비트** ⇒ 멀티캐스트용의 IPv4 주소의 하위 23비트를 그대로 복사
- IPv6를 통한 수신지 MAC 주소
    - **상위 2바이트 고정** ⇒ `0011 0011 0011 0011` , 33:33
    - **하위 4바이트** ⇒ 멀티캐스트용의 IPv4 주소의 하위 4바이트를 그대로 복사

### 3.1.3 L2 스위치

> 데이터링크 계층에서 동작하는 네트워크 기기
> 

스위칭 허브 or 스위치라고 칭함

- 이더넷 헤더에 포함된 송신지 MAC 주소와 자신의 포트 번호를 `MAC 주소 테이블`이라는 메모리 상의 테이블로 관리
- **이더넷 프레임의 전송 대상지를 바꾸어** 통신 효율 ⬆️

### ▶️ L2 스위칭

> 이더넷 프레임의 전송 대상지를 바꾸는 기능
> 

![image](https://github.com/user-attachments/assets/d8683a9a-bc52-4a5b-ac13-52af0e26962e)


① PC1은 PC2에 대한 이더넷 프레임 생성 후 케이블로 전송

② PC1의 프레임을 전달받은 L2 스위치는 이더넷 프레임의 송신지 MAC 주소와 이더넷 프레임을 전달 받은 물리 포트 번호를 MAC 테이블에 저장

③ 플러딩(flooding)을 통해 PC1으로부터 받은 이더넷 프레임 사본을 PC1에 접속된 포트 번호 외의 모든 물리 포트에 전달

④ PC2는 PC1에 대한 응답 프레임을 만들어 케이블로 보냄 + PC3은 자신과 관계 없는 이더넷 프레임이라고 판단 후, 파기

![image](https://github.com/user-attachments/assets/6d35091b-a86c-42d0-a267-ba6a1d4b97e3)


⑤ L2 스위치는 PC2에 이더넷 프레임을 전달 받은 후, 송신지 MAC 주소에 들어있는 PC2의 MAC 주소와 프레임을 전달 받은 물리 포트 번호를 MAC 주소 테이블에 등록

⑥ L2 스위치는 PC1과 PC2가 어떤 물리 포트에 접속되어 있는지 확인. 이후 PC1과 PC2 사이의 통신 직접 전송

⑦ L2 스위치는 일정 시간 통신하지 않으면 해당 MAC 주소 테이블에 해당 내용 삭제, 삭제할 때까지의 대기 시간 존재

### ▶️ VLAN

> 1대의 L2 스위치를 여러 대의 L2 스위치로 가상 분할하는 기술
> 
- 포트 기반 VLAN
- 태그 VLAN

![image](https://github.com/user-attachments/assets/3c8a1752-a4ee-4e39-8357-3a8d9c7e6083)


### ▶️ 포트 기반 VLAN

> 하나의 포트에 하나의 VLAN을 할당하는 기능
> 

VLAN1(PC1, PC2), VLAN2(PC3, PC4)는 같은 그룹끼리는 통신할 수 있지만 다른 그룹끼리는 통신 불가능

![image](https://github.com/user-attachments/assets/6a943db9-8bc5-4a3a-b057-7a6e83423308)


### ▶️ 태그 VLAN

> 이더넷 프레임에 VLAN 정보를 VLAN 태그로 붙이는 기능
> 

포트 개수만큼 케이블이 필요한 포트 기반 VLAN과는 달리,

태그 VLAN은 **포트 종류당 하나의 케이블**이 필요하다.

![image](https://github.com/user-attachments/assets/6e3c53c2-cd4d-451a-a114-377db6857660)


### ▶️ PoE(Power over Ethernet)

> 트위스트 페어 케이블을 사용해 전원을 공급하는 기능
> 

![image](https://github.com/user-attachments/assets/b7d61423-7e87-4f53-b02d-538ca6b7a3c1)


PoE의 종류

- **PoE**
- **PoE+**
- **PoE++**

이들의 가장 큰 차이점은 1포트당 제공할 수 있는 최대 전력이다.

늦게 표준화된 프로토콜이 더 큰 전력을 공금할 수 있음(하단 표 참고)

![image](https://github.com/user-attachments/assets/9a098bb9-b691-468f-b19c-21220b151584)


## 📌 3.2 무선 LAN(IEEE802.11)

전파로 패킷을 교환하기 때문에 유선보다 더욱 복잡한 통신 제어나 보안 제어가 필요.

IEEE802.11에서는 캡슐화하는 포맷은 물론, 프레임을 안전하게 교환하는 방법이 정의하고 있음.

### 3.2.1 IEEE802.11 프레임의 프레임 포맷

IEEE802.11 프레임에는 전송 속도나 변조 방식 등 무선과 관련한 많은 제어 정보가 포함되어 있음.

MAC 주소 필드 4개로 증가

![image](https://github.com/user-attachments/assets/6aff3cbc-1185-44c8-a1f8-a7cab728f8e9)


**IEEE802.11의 필드 종류**

- 프리앰블
    - IEEE802.11 프레임을 보내겠다는 신호를 가진 가변 길이 필드
- 프레임 제어
    - 프레임 제어에 필요한 정보를 포함한 2바이트 필드 (프레임 종류, 송신지/수신지 종류, 프래그먼트, 전력 상태 등 설정)
        - 프레임 종류
            - 데이터 프레임
                - IP 패킷을 송수신하기 위한 프레임(유선 LAN에는 존재❌)
            - 관리 프레임
                - 어떤 액세스 포인트와 어떻게 접속할 것인지 관리하는 프레임
                - 액세스 포인트는 관리 프레임의 하나인 `비콘`을 이용해 액세스 포인트의 존재를 정기적으로 알림
                - 무선 LAN 단말은 비콘 프레임을 잡고 난 후, **프로브 요청/응답, 인증, 어소시에이션 요청/응답** 총 3가지 관리 프레임을 사용해서 접속을 관리
                - ⇒ 이 접속 처리 전체를 **`어소시에이션`**이라 칭함
                
                ![image](https://github.com/user-attachments/assets/4378f4dc-0f44-4eaa-a8e1-8a1579889df5)

                
            - 제어 프레임
                - 데이터 프레임의 전송을 돕기 위해 존재하는 프레임
                - 불안정한 무선 LAN은 확인 응답을 제어 프레임의 하나인 ACK 프레임을 사용
- Duration/ID
    - 무선 회선을 점유할 예정  시간의 알림이나 단말의 배터리 소비량을 제어하는 전원 관리 식별자에 사용되는 2바이트 필드
- MAC 주소 1/2/3/4
    - 데이터 프레임의 MAC 주소
        - 인프라 모드
            - 무선 LAN 단말이 반드시 액세스 포인트를 경유해 통신하는 네트워크 구성
            - 거의 대부분의 무선 LAN 환경이 인프라 모드로 구성
            - 무선 구간의 수신지 MAC 주소 | 무선 구간의 송신지 MAC 주소 | 무선 LAN 단말의 송신지 or 수신지 MAC 주소 로 필드 구성. 마지막 네 번째 필드는 없음.
            
            ![image](https://github.com/user-attachments/assets/206a1bc0-9144-4501-8c8b-d20ffd6fc158)

            
        - 애드혹 모드
            - 액세스 포인트를 경유하지 않고 무선 LAN 단말끼리 직접 통신하는 네트워크 구성
            - 직접 파일을 교환할 때 등에 사용
            - 무선 구간의 수신지 MAC 주소 | 무선 구간의 송신지 MAC 주소 | 사용자가 정의한 ID로 구성. 마지막 네 번째 필드는 없음.
            
            ![image](https://github.com/user-attachments/assets/91f891d1-ca70-4d83-9aac-1bc4034a0f76)

            
        - WDS 모드
            - 액세스 포인트끼리 통신하는 네트워크 구성
            - 무선 LAN으로 네트워크를 연장할 때 등에 사용
            - 무선 구간의 수신지 MAC 주소 | 무선 구간의 송신지 MAC 주소 | 수신지 MAC 주소 | 송신지 MAC 주소
            
            ![image](https://github.com/user-attachments/assets/88e67899-cb75-45bf-a719-0c177da43163)

            
    - 관리 프레임의 MAC 주소
        - 무선 구간의 수신지 MAC 주소 | 무선 구간의 송신지 MAC 주소 | 액세스 포인트의 MAC 주소. 마지막 네 번째 필드는 없음.
            
            ![image](https://github.com/user-attachments/assets/088acf7c-deda-43d5-9af3-755a4df5e17f)

            
    - 제어 프레임의 MAC 주소
        - 제어 프레임에 설정된 MAC 주소 필드 수는 프레임 용도에 따라 달라짐
        - ex) 제어 프레임 하나인 ACK 프레임은 MAC 주소 필드를 하나만 가짐
            
            ![image](https://github.com/user-attachments/assets/592c138c-e83b-4f82-bc24-3238b8736b6b)

            
- 시퀀스 제어
    - **4비트의 프래그먼트 신호 + 12비트 시퀀스 신호**로 구성된 필드
    - 프래그멘테이션된 프레임을 재결합하거나 중복된 프레임을 파기할 때 사용
    
    ![image](https://github.com/user-attachments/assets/24f8d473-7421-46a9-8f9f-b73c10f7cace)

    
- IEEE802.11 페이로드
    - 상위 계층의 데이터 설정
    - 데이터 프레임의 경우
        
        네트워크 계층의 프로토콜 정보를 의미하는 타입 필드를 포함하는 LLC 헤더로 한 번 더 캡슐화한 뒤, 네트워크 계층의 데이터, 즉 IP 패킷을 설정한다.
        
    - 관리 프레임의 경우
        
        무선 LAN의 이름을 의미하는 SSID나 사용하는 채널, 지원하는 전송 속도 등 네트워크에 관한 다양한 정보가 설정
        
    - 제어 프레임의 경우
        
        페이로드가 없다. 모든 정보가 헤더에 기록.
        
- FCS
    - IEEE802.11 페이로드가 손상되지 않았는가를 확인하기 위한 4바이트 필드

### 3.2.2 무선 LAN 단말이 접속되기까지

무선 LAN은 총 4단계에 거쳐 암호화 통신을 진행

`어소시에이션` ⇒ `인증` ⇒ `공유키 생성` ⇒ `암호화 통신`

![image](https://github.com/user-attachments/assets/fc7b56a0-d966-488a-b444-a0b33068e84e)


### ▶️ 어소시에이션 단계

어떤 액세스 포인트와 접속할지 결정하는 단계

`스캔 ⇒ 인증 ⇒ 어소시에이션`

- 스캔
    - 스캔은 액세스 포인트와 무선 LAN 단말이 서로의 존재를 인식하는 단계
        <details>
        <summary>스캔 과정</summary>
        
            ```
            ⇒ 무선 LAN 단말은 액세스 포인트로부터 정기적으로 송출되는 비콘을 수신 후, SSID나 채널, 지원하는 송신 속도 등 주변에 있는 무선 LAN 정보를 수집
            
            ⇒ 접속할 SSID를 발견하면 프로브 요청을 송신하고 자신의 존재를 액세스 포인트에게 전달
            
            ⇒ 프로브 요청을 받은 액세스 포인트는 SSID나 전송 속도 등 몇 가지 파라미터가 일치하면 “프로브 응답을 반환하고 인증 단계로 이동
            
            ⇒ 여러 액세스 포인트로부터 동일한 SSID 프로브 응답을 받은 경우에는 가장 품질이 좋은 액세스 포인트를 선택 후 그에 대해 인증 처리
            ```
        </details>
            
- 인증
    - 오픈 시스템 인증과 공유키 인증
    - 오픈 시스템 인증
        - 인증 처리를 하지 않음
        - 모든 인증 요청에 대해 인증을 허가
    - 공유키 인증
        - 미리 무선 LAN 단말과 액세스 포인트에서 공유한 비밀번호에 기반해 인증
        - 오픈 시스템 인증으로 통과시킨 뒤, 실제 인증은 어소시에이션 뒤의 인증 단계에서 수행
        - ex) WEP(Wired Equivalent Privacy)
- 어소시에이션
    - 최종 확인 과정
    - 무선 LAN 단말은 접속할 액세스 포인트에 대해 어소시에이션 요청을 송신
    - 액세스 포인트는 어소시에이션 응답을 반환 후, 접속 확립
    
    ![image](https://github.com/user-attachments/assets/7537427a-2648-4252-a8dd-2cec5446e494)

    

### SSID

어소시에이션에서 SSID는 무선 LAN을 식별하기 위한 문자열로, 간단히 말해 무선 LAN의 이름

즉, 네트워크 이름이라고 생각하면 됨.

### ▶️ 인증 단계

액세스 포인트나 인증 서버는 접속상대가 올바른 단말인지 확인하는 인증을 수행

ex) 가정의 와이파이

### 퍼스널 모드

**비밀번호로 인증하는 방식**

무선 LAN 단말과 액세스 포인트는 어소시에이션이 완료된 후, 비밀번호로부터 마스터키라 부르는 공유키의 소재를 생성

장점 ⇒ 간단하고 쉬움.

단점 ⇒ 간단하지만 비밀번호가 유출되면 **누구나 접속할 수 있어 위험성이 높음**. 정기적으로 비밀번호를 변경하는 등 보안 수준 유지 필요.

### 엔터프라이즈 모드

**디지털 인증서나 ID/비밀번호, SIM 카드 등을 사용해 인증하는 방식**

인증 서버에서 일괄적으로 인증

인증에 성공하면 액세스 포인트와 무선 LAN 단말에 세션키가 배포된 후, 마스터키 생성

장점 ⇒ 사원이 퇴사하거나 단말을 분실했을 때도 인증 서버의 등록 정보를 변경해 대응할 수 있고 보안 레벨 계속 유지 가능

단점 ⇒ 디지털 인증서나 ID/비밀번호 등 별도로 운용 관리해야 하기 때문에 지속적으로 비용 발생

IEEE802.1x로 표준화

EAP 라는 인증 프로토콜을 사용해 인증

LAN으로 보내기 위해 EAPoL 프로토콜로 캡슐화 후, 액세스 포인트- 인증 서버 사이를 RADIUS라는 UDP 인증 프로토콜로 캡슐화

EAP 프로토콜 종류

- EAP-TLS
    - 디지털 인증서로 양방향 인증하는 프로토콜
- PEAP
    - ID/비밀번호로 무선 LAN 단말을 인증하고 디지털 인증서로 인증 서버를 인증하는 프로토콜
- EAP-SIM/AKA
    - SIM 카드의 정보를 이용해 양방향 인증하는 프로토콜

### ▶️ 공유키 생성 단계

인증 단계에서 생성한 마스터키로부터 실제 암호화/복호화해서 사용하는 공유키를 생성하는 단계

4웨이 핸드셰이크를 통해 유니캐스트와 멀티캐스트용 공유키를 생성해서 공유.

![image](https://github.com/user-attachments/assets/920df956-8e0f-40c3-8556-6ffbe232f724)


### ▶️ 암호화 통신 단계

WEP ⇒ WPA ⇒ WPA2 ⇒ WPA3 순으로 보안 레벨이 높아진다.

### 암호화 방식

- WEP
    - RC34 암호화 구조를 이용
    - 같은 공유기를 계속해서 사용할 뿐만 아니라, RC4 자체에 치명적인 취약성이 발견되었기에 현재는 거의 사용 ❌
- WPA
    - WEP를 개량해 취약성을 낮추는 것을 목적으로 한 암호화 방식
    - RC4에 공유키를 생성해 일정 간격으로 변경하는 TKIP를 추가해, 보안 수준 향상
    - 근데 이것도 WEP 기반이기 때문에 문제 있다고 판단
- WPA2
    - WPA를 한층 개량한 암호화 방식
    - 암호화 알고리즘으로 AES 사용
    - 가장 많이 사용
- WPA3
    - WPA2를 한층 개량한 암호화 방식
    - 엔터프라이즈 모드의 암호화 방식으로 AES보다 더욱 안전한 CNSA에 대응
    - 4웨이 핸드셰이크에 SAE 핸드셰이크 단계 + 관리 프레임을 암호화하는 PMF 등을 추가해 더욱 강력한 보안 수준 구현
    

### 3.2.3 무선 LAN의 형태

### ▶️ 분산 관리형

액세스 포인트를 1대씩 설정하고 각각 운용 관리하는 형태

ex) 가정이나 소규모 사무실의 무선 LAN 환경

장점 ⇒ 액세스 포인트만으로 무선 LAN 환경을 구축할 수 있기 때문에 비용 축소 가능

단점 ⇒ 액세스 포인트 수가 늘어날 수록 운용 관리 어려워짐 + 변하기 쉬운 주위 전파 환경에 자동으로 대응 어려워 주의 필요

![image](https://github.com/user-attachments/assets/f5ba56d0-72f0-4e2e-a930-d81706529239)


### ▶️ 집중 관리형

무선 LAN 컨트롤러라는 서버를 사용해 많은 액세스 포인트를 운용 관리하는 형태

ex) 중간 규모에서 대규모 사무실의 무선 LAN 환경

장점 ⇒ 액세스 포인트 수가 많아져도 운용관리 복잡해지지 않음. 무선 LAN 컨트롤러가 운용관리 및 설정이나 펌웨어 업데이트, 전파 간섭을 감지 후 필요에 따라 채널을 조정해주는 등 깨끗한 전파환경 유지

단점 ⇒ 무선 LAN 컨트롤러로 인한 초기 비용과 성능 한계로 인한 추가 비용 가능성

![image](https://github.com/user-attachments/assets/65f68c44-0324-4fe3-a292-c14eead386fd)


### ▶️ 클라우드 관리형

집중 관리형의 진화 버전으로 무선 LAN 컨트롤러의 기능을 클라우드에 갖도록 한 클라우드 컨트롤러에서 액세스 포인트를 관리하는 형태

장점 ⇒ 무선 컨트롤러를 준비할 필요가 없어 초기 비용 감소.

단점 ⇒ 클라우드 운영 비용이 듦.

![image](https://github.com/user-attachments/assets/9e5d3b92-ab2f-42e5-8543-0df0fed26e52)


### 3.2.4 무선 LAN과 관련된 다양한 기능

### ▶️ 게스트 네트워크

방문자에게 제공되는 무선 LAN 환경

### ▶️ MAC 주소 필터링

단말의 MAC 주소를 기반으로 필터링(허가/거부)하는 기능

미리 허가할 단말의 MAC 주소를 등록해 두고 그 외는 접속을 거부

단말의 수가 적을 때 좋고 많아졌을 때는 운용 관리가 복잡해짐

### ▶️ 웹 인증

웹브라우저에서 사용자 이름과 비밀번호를 입력해 인증하는 방식

ex) 호텔이나 역의 공공 무선 LAN 또는 기업의 게스트 네트워크 와이파이

### ▶️ 밴드 스티어링

2.4GHz 대역과 5GHz 대역의 양쪽 주파수 대역에 대응하는 무선 LAN 단말을 전파 간섭이 발생하기 어려운 5GHz 대역으로 유도

**밴드 셀렉트**라고도 칭함

## 📌 3.3 ARP

### ▶️ ARP(Address Resolution Protocol)

MAC 주소와 IP 주소를 접속해 데이터링크 계층과 네트워크 계층의 다리 역할을 하는 프로토콜

네트워크에서의 주소

- MAC 주소: NIC 자체에 내장되어 있는 물리적인 주소. 데이터링크에서 동작
- IP 주소: OS 상에서 설정한 논리적인 주소. 네트워크 계층에서 동작

![image](https://github.com/user-attachments/assets/12fe91f2-456a-4e42-833a-aa3916b85512)


어떤 단말이 데이터를 송신 시, IP패킷을 이더넷 프레임으로 캡슐화하여 케이블로 보내는데 이더넷 프레임의 정보가 부족한 문제 발생 ⇒ 송신지 MAC 주소는 알지만 수신지 MAC 주소를 알지 못하는 문제

➡️ ARP에서 수신지 IPv4 주소로부터 수신지 MAC 주소를 구하는데, 이것을 `주소 결정`이라고 한다.

### 3.3.1 ARP의 프레임 포맷

![image](https://github.com/user-attachments/assets/f94c6c89-a1f1-4340-9f77-abd85c5da620)


- 하드웨어 타입
    - 사용하는 레이어2 프로토콜을 의미하는 2바이트 필드
- 프로토콜 타입
    - 사용하는 레이어3 프로토콜을 의미하는 2바이트 필드
- 하드웨어 주소 크기
    - 하드웨어 주소 크기, 즉 MAC 주소의 길이를 바이트 단위로 나타내는 1바이트 필드
- 프로토콜 주소 크기
    - 네트워크 계층에서 사용하는 주소 크기, 즉 IP 주소의 길이를 바이트 단위로 나타내는 1바이트 필드
- 오퍼레이션 코드
    - ARP 프레임의 종류를 나타내는 2바이트 필드
- 송신지 MAC 주소/송신지 IPv4 주소
    - ARP를 송신하는 단말의 MAC 주소와 IPv4 주소를 나타내는 가변 길이 필드
- 목표 MAC 주소/목표 IPv4 주소
    - ARP로 주소를 결정하려는 MAC 주소와 IPv4 주소를 나타내는 가변 길이 필드

### 3.3.2 ARP에 의한 주소 결정 흐름

ARP는 다음 두 패킷만으로 MAC 주소와 IP 주소를 연결한다.

**ARP Request**

- 같은 네트워크에 있는 단말 모두에게 브로드캐스트로 패킷을 송신
- ~~님 계십니까?와 같은 의미

**ARP Reply**

- 1:1 유니캐스트로 송신
- 네~ 여기있습니다!와 같은 의미

![image](https://github.com/user-attachments/assets/98856461-c15e-4ddb-ac72-1ebd84bfd22a)


### 3.3.3 ARP 캐시 기능

ARP의 취약점 ⇒ 브로드캐스트를 전제로 한다는 점

모든 통신의 처음인 ARP는 상대의 MAC 주소를 모르기 때문에 브로드캐스트를 써야할 수밖에 없음.

But, 브로드캐스트는 같은 네트워크에 있는 모든 단말에 데이터를 보내는 비효율적 통신 방식

ex) 1,000대 단말이 있다면 1,000대 모두에게 트래픽을 보내야 함.

➡️ 그렇기 때문에 주소 결정한 내용을 일정 기간 저장하는 `캐시 기능`을 제공

캐싱하는 동안에는 ARP 송신하지 않음!

### 3.3.4 GRAP를 이용한 기능

ARP 필드의 목표 IPv4 주소에 자신의 IPv4를 설정한 특별한 ARP

⇒ IP 주소 중복 감지나 인접 기기의 테이블 업데이트 등에 사용

- IPv4 주소 중복 감지
    
    ![image](https://github.com/user-attachments/assets/83440f84-999f-4a7f-b3e6-196a89a834f0)

    
- 인접 기기의 테이블(ARP 테이블과 MAC 주소 테이블) 업데이트
    - GARP를 이용해 ‘내 IPv4 주소와 MAC 주소는 이것입니다!’라고 알림으로써, 인접 기기의 ARP 테이블과 MAC 주소 테이블의 정보 업데이트를 도움.
        
        ![image](https://github.com/user-attachments/assets/556572c6-6d88-499e-928d-5bd9d08dba04)

        

## 📌 3.4 기타 L2 프로토콜

이 프로토콜들은 데이터링크 계층에서 동작하지만 L2 스위치나 액세스 포인트가 처리할 수는 없음.

라우터나 방화벽 등 상위 계층의 기기가 처리할 수 있는 프로토콜이다.

### 3.4.1 PPP(Point to Poin Protocol)

포인트와 포인트를 1:1로 접속하기 위한 레이어2 프로토콜

PPP는 링크를 확립, 유지, 단절하는 LCP, PAP, CHAP, IP

![image](https://github.com/user-attachments/assets/8c43e3b4-eba2-43e5-935e-e5e1c59c4d5a)


### PAP(Password Authentication Protocol)

PPP 클라이언트가 사용자 ID와 비밀번호를 송신하고 서버가 미리 설정해 둔 사용자 ID와 비밀번호를 기반으로 인증.

현재는 거의 사용되지 않으며, 이후 설명할 CHAP로 대체됨.

![image](https://github.com/user-attachments/assets/0be7d11d-db1c-4964-bacc-b423822d0617)


### CHAP(Challenge Handshake Authentication Protocol)

PAP의 보안적인 약점을 보완해 강화한 프로토콜.

PPPoE, L2TP over IPsec 등 PPP가 관련된 프로토콜이 인증에서는 기본적으로 CHAP를 사용.

### 3.4.2 PPPoE

원래 다이얼업 접속에서 사용되던 PPP를 이더넷 네트워크상에서도 사용할 수 있도록 확장한 프로토콜.

플렛츠 네트워크 내부망에 접속할 때 사용.

![image](https://github.com/user-attachments/assets/3fb1ddd3-b119-4c9a-b207-28137777aa4c)


### 3.4.3 IPoE

PPPoE를 통해 패킷이 혼잡해 인터넷에 접속하기 어려워 새롭게 개발된 플렛츠 접속 방식.

이더넷과 IP를 그대로 사용할 수 있기 때문에 **네이티브 접속 방식**이라 불림.

![image](https://github.com/user-attachments/assets/6831a858-931c-4fc8-9824-a0715c847661)


### 3.4.4 PPTP

이더넷상에 가상 전용선을 만드는 VPN 프로토콜.

![image](https://github.com/user-attachments/assets/7c4a836d-8376-4b47-a129-5b1f45506711)


### 3.4.5 L2TP

IPsec나 PPTP와 마찬가지로 인터넷상에 가상 전용선을 만드는 프로토콜.

![image](https://github.com/user-attachments/assets/198c73ab-c24f-4b82-b574-850749a6b994)


### L2TP over IPsec

암호화 기능을 갖지 않는 L2TP를 위해 만들어진 것.

보안 기능을 가진 IPsec을 함께 사용해 L2TP over IPsec으로 사용하는 경우가 대부분.

![image](https://github.com/user-attachments/assets/ecb988cc-8e43-4254-89eb-7d9482b3f224)
